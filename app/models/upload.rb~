class Upload < ActiveRecord::Base
  
  MAX_ATTACHMENTS =5
  MAX_ATTACHMENT_SIZE=2.megabyte
  belongs_to :post 
  before_save :savePreview
  after_save :destroyPreview
  has_attached_file :img,
    :storage=>:filesystem,
    :styles => {
    :small=>"300x300>",
    :large=>"600x600>"}

  
  def name
    img_file_name
  end 
  
  def type
    img_content_type
  end

  def size
    img_file_size
  end
  def savePreview
    @preview = UploadPreview.getPreviews(getIdent).first
    if !preview.nil?
      name=preview.named
      size=preview.size
      type=preview.type
    end
  end
  def destroyPreview
    @preview.destroy
  end

  private 

  def getIdent
    ident = self.post.ident
    self.photo_content_type = ident
  end
  def name=(filename)
    self.img_file_name=filename
  end
  def size=(filesize)
    self.img_file_size=filesize
  end
  def type=(filetype)
    self.img_file_type=filetype
  end
end
